/*
SQLyog Community v13.1.1 (64 bit)
MySQL - 10.1.37-MariaDB : Database - appenfermeria
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
DROP DATABASE IF EXISTS appenfermeria;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`appenfermeria` /*!40100 DEFAULT CHARACTER SET utf8 */;

USE `appenfermeria`;

/*Table structure for table `usuario` */

DROP TABLE IF EXISTS `usuario`;

CREATE TABLE `usuario` (
  `email` CHAR(75) NOT NULL,
  `token` VARCHAR(100) DEFAULT NULL,
  `fecha_vencimiento_token` DATETIME DEFAULT NULL,
  `baja_usuario` DATETIME DEFAULT NULL,
  `contrasenya` CHAR(70) NOT NULL,
  `admnistrador` BOOLEAN DEFAULT FALSE,
  PRIMARY KEY (`email`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `usuario` */

INSERT  INTO `usuario`(`email`,`token`,`fecha_vencimiento_token`,`baja_usuario`,`contrasenya`,`admnistrador`) VALUES 
('pedrojose@hotmail.com','$2y$11$.NibMvCrs.vzNKD4L2b9wO5OUSQQYyxX5TmZUhopHV0QI23Xo1BjK','2022-11-25 17:14:05',NULL,'8cb2237d0679ca88db6464eac60da96345513964',NULL);

/*Table structure for table `grupo` */

DROP TABLE IF EXISTS `grupo`;

CREATE TABLE `grupo` (
  `id` INT AUTO_INCREMENT NOT NULL,
  `nombre` CHAR(15) DEFAULT NULL,
  fecha_baja DATETIME NULL,
  PRIMARY KEY (`id`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `grupo` */
INSERT INTO grupo VALUES
(NULL,"grupo 1", NULL),
(NULL,"grupo 2", NULL),
(NULL,"grupo 3", NULL),
(NULL,"grupo 4", NULL);


/*Table structure for table `tecnico` */

DROP TABLE IF EXISTS `tecnico`;

CREATE TABLE `tecnico` (
  `id_usuario` CHAR(75) NOT NULL,
  `nombre` CHAR(15) DEFAULT NULL,
  `apellidos` VARCHAR(30) DEFAULT NULL,
  `telefono` VARCHAR(15) DEFAULT NULL,
  `fecha_nacimiento` DATE DEFAULT NULL,
  `genero` ENUM('Hombre','Mujer','Indefinido') NOT NULL,
  `id_grupo` INT NOT NULL, 
  PRIMARY KEY (`id_usuario`),
  KEY `FK_tecnico_grupo` (`id_grupo`),
  CONSTRAINT `FK_tecnico_grupo` FOREIGN KEY (`id_grupo`) REFERENCES `grupo` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `FK_tecnico_usuario` FOREIGN KEY (`id_usuario`) REFERENCES `usuario` (`email`) ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `tecnico` */

INSERT  INTO `tecnico`(`id_usuario`,`nombre`,`apellidos`,`telefono`,`fecha_nacimiento`,`genero`,`id_grupo`) VALUES 
('pedrojose@hotmail.com','pedro','jose','675842210','2000-10-10','Hombre',1);

/*Table structure for table `profesor` */

DROP TABLE IF EXISTS `profesor`;

CREATE TABLE `profesor` (
  `id_usuario` CHAR(9) NOT NULL,
  `nombre` CHAR(15) DEFAULT NULL,
  `apellidos` VARCHAR(30) DEFAULT NULL,
  `telefono` VARCHAR(15) DEFAULT NULL,
  `fecha_nacimiento` DATE DEFAULT NULL,
  `genero` ENUM('Hombre','Mujer','Indefinido') NOT NULL,
  PRIMARY KEY (`id_usuario`),
  CONSTRAINT `FK_profesor_usuario` FOREIGN KEY (`id_usuario`) REFERENCES `usuario` (`email`) ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `profesor` */

/*Table structure for table `paciente` */

DROP TABLE IF EXISTS `paciente`;

CREATE TABLE `paciente` (
  `telefono` CHAR(15) NOT NULL,
  `nombre` CHAR(15) DEFAULT NULL,
  `apellidos` VARCHAR(30) DEFAULT NULL,
  `usuario_asignado` CHAR(75) DEFAULT NULL,
  `padecimientos` VARCHAR(750) DEFAULT NULL,
  `observaciones` VARCHAR(750) DEFAULT NULL,
  `medicacion` VARCHAR(750) DEFAULT NULL,
  `fecha_nacimiento` DATE DEFAULT NULL,
  `fecha_baja` DATE DEFAULT NULL,
  `genero` ENUM('Hombre','Mujer') DEFAULT NULL,
  `localidad` CHAR(20) DEFAULT NULL,
  PRIMARY KEY (`telefono`),
  KEY `FK_paciente_usuario` (`usuario_asignado`),
  CONSTRAINT `FK_paciente_usuario` FOREIGN KEY (`usuario_asignado`) REFERENCES `usuario` (`email`) ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `paciente` */

INSERT  INTO `paciente`(`telefono`,`nombre`,`apellidos`,`usuario_asignado`,`padecimientos`,`observaciones`,`medicacion`,`fecha_nacimiento`,`fecha_baja`,`genero`,`localidad`) VALUES 
('+34747486442','manolo','pedro','pedrojose@hotmail.com',NULL,'le gusta el futbol',NULL,'2022-12-01',NULL,'Hombre',NULL);


/*Table structure for table `grupo_profesor` */

DROP TABLE IF EXISTS `grupo_profesor`;

CREATE TABLE `grupo_profesor` (
   id INT AUTO_INCREMENT NOT NULL,
  `id_profesor` CHAR(75) NOT NULL,
  `id_grupo` INT NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `FK_grupo_profeso_grupo` FOREIGN KEY (`id_grupo`) REFERENCES `grupo` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `FK_grupo_profesor_profesor` FOREIGN KEY (`id_profesor`) REFERENCES `profesor` (`id_usuario`) ON UPDATE CASCADE,
  CONSTRAINT UQ_id_profesor_id_grupo UNIQUE (id_profesor, id_grupo)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `grupo_profesor` */


/*Table structure for table `evento` */

DROP TABLE IF EXISTS `evento`;

CREATE TABLE `evento` (
  `tipo_evento` ENUM('Cumplea√±os','Recortadorio','Supervisar','Otro') NOT NULL,
  `observaciones` VARCHAR(150) NOT NULL,
  `id_paciente` CHAR(9) NOT NULL,
  `fecha_evento` DATETIME NOT NULL,
  `id_usuario` CHAR(75) NOT NULL,
  PRIMARY KEY (`id_paciente`,`fecha_evento`),
  CONSTRAINT `FK_evento_paciente` FOREIGN KEY (`id_paciente`) REFERENCES `paciente` (`telefono`) ON UPDATE CASCADE,
  CONSTRAINT `FK_evento_usuario` FOREIGN KEY (`id_usuario`) REFERENCES `usuario` (`email`) ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `evento` */


/*Table structure for table `mensaje` */

DROP TABLE IF EXISTS `mensaje`;

CREATE TABLE `mensaje` (
  `id` INT AUTO_INCREMENT NOT NULL,
  `contenido` VARCHAR(255)  NOT NULL,
  `id_usuario_emisor` CHAR(75)  NOT NULL,
  `id_grupo_receptor` INT  NOT NULL,
  `visto` BOOLEAN DEFAULT FALSE,
  `hora_envio` DATETIME NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `FK_mensaje_grupo` FOREIGN KEY (`id_grupo_receptor`) REFERENCES `grupo` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `FK_mensaje_usario` FOREIGN KEY (`id_usuario_emisor`) REFERENCES `usuario` (`email`) ON UPDATE CASCADE,
  CONSTRAINT UC_clave_alternativa UNIQUE (id_usuario_emisor, id_grupo_receptor, hora_envio)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

/*Data for the table `mensaje` */

DROP TABLE IF EXISTS registro_lladadas;

CREATE TABLE IF NOT EXISTS registro_llamadas(
	id INT AUTO_INCREMENT NOT NULL,
	id_tecnico CHAR(15) NOT NULL,
	id_paciente CHAR(15) NOT NULL,
	inicio_llamada DATETIME NOT NULL,
	final_llamada DATETIME NOT NULL,
	observaciones VARCHAR(500) NULL,
	
	PRIMARY KEY(id),
	CONSTRAINT `FK_registro_llamadas_tecnico` FOREIGN KEY (`id_tecnico`) REFERENCES `tecnico` (`id_usuario`) ON UPDATE CASCADE,
	CONSTRAINT `FK_registro_llamadas_paciente` FOREIGN KEY (`id_paciente`) REFERENCES `paciente` (`telefono`) ON UPDATE CASCADE,
	CONSTRAINT UC_clave_alternativa UNIQUE (id_tecnico, id_paciente, inicio_llamada, final_llamada)
) ENGINE=INNODB DEFAULT CHARSET=utf8;


/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;